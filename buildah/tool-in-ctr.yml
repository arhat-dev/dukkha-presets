# Optional env:
#   - DOCKER_CLI the docker cli compatible command for running container
#   - VOLUME_NAME for caching go modules in container
#   - WORKING_DIR for switching to different golang project
#   - IMAGE to override defualt official buildah image

use_shell: false
shell_name: ""
cmd@template: |-
  {{- $docker_cli := values.tools.docker_cli }}
  {{- if not $docker_cli -}}
    {{- $docker_cli = strings.Split " " (default "docker run -t" env.DOCKER_CLI) -}}
  {{- end }}
  {{- range $_, $v := $docker_cli }}
    {{- if $v }}
  - {{ $v }}
    {{- end }}
  {{- end }}
  - --entrypoint
  - ""
  - --workdir
  - {{ env.WORKING_DIR | default env.DUKKHA_WORKING_DIR }}
  - -v
  - {{ env.DUKKHA_WORKING_DIR -}}:{{- env.DUKKHA_WORKING_DIR }}
  - -v
  - {{ env.VOLUME_NAME | default "buildah" -}}:/var/lib/containers
  - --device
  - /dev/fuse:rw
  - {{ env.IMAGE | default "quay.io/containers/buildah" }}
  - buildah
